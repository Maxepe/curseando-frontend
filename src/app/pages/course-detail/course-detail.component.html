<div class="course-detail-container">
  <div class="container">
    <button class="btn-back" (click)="goBack()">
      <span class="back-icon">‚Üê</span>
      Atr√°s
    </button>

    @if (loading) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Cargando...</p>
      </div>
    }

    @if (error && !loading) {
      <div class="error-container">
        <div class="error-card">
          <h2>Error al Cargar la informaci√≥n</h2>
          <p>{{ error }}</p>
          <button class="btn btn-primary" (click)="retry()">Intentar de Nuevo</button>
        </div>
      </div>
    }

    @if (course && !loading && !error) {
      <div class="course-content">
      <div class="course-header">
        <div class="header-top">
          <span class="difficulty-badge" [ngClass]="'difficulty-' + course.difficulty.toLowerCase()">
            {{ getDifficultyLabel(course.difficulty) }}
          </span>
          <div class="seats-indicator" [ngClass]="{
            'seats-full': isFull(),
            'seats-low': isLowSeats(),
            'seats-available': !isFull() && !isLowSeats()
          }">
            @if (isFull()) {
              <span class="seats-status">Sin Cupos</span>
            } @else if (isLowSeats()) {
              <span class="seats-status">Quedan {{ course.seatsLeft }} cupos!</span>
            } @else {
              <span class="seats-status">{{ course.seatsLeft }} cupos disponibles</span>
            }
          </div>
        </div>

        <h1 class="course-title">{{ course.title }}</h1>

        <div class="course-meta">
          <div class="meta-item">
            <span class="meta-icon">üë®‚Äçüè´</span>
            <span class="meta-label">Instructor:</span>
            <span class="meta-value">{{ course.instructor }}</span>
          </div>

          <div class="meta-item">
            <span class="meta-icon">‚è±Ô∏è</span>
            <span class="meta-label">Duraci√≥n:</span>
            <span class="meta-value">{{ course.duration }}</span>
          </div>

          <div class="meta-item">
            <span class="meta-icon">üìö</span>
            <span class="meta-label">Conocimiento Previo Requerido:</span>
            <span class="meta-value">{{ 'course.requiredKnowledge' }}</span>
          </div>
        </div>
      </div>

      <div class="details-grid">
        <div class="details-main">
          <div class="detail-card">
            <h2>Acerca Del Curso</h2>
            <p class="course-description">{{ course.description }}</p>
          </div>

          <div class="detail-card">
            <h3>Contenido del Curso</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Creado:</span>
                <span class="info-value">{{ formatDate(course.createdAt) }}</span>
              </div>
              @if (course.updatedAt !== course.createdAt) {
                <div class="info-item">
                  <span class="info-label">Ultima Actualizaci√≥n:</span>
                  <span class="info-value">{{ formatDate(course.updatedAt) }}</span>
                </div>
              }
            </div>
          </div>
        </div>

        <div class="details-sidebar">
          <div class="enrollment-card">
            <h3>Inscripciones</h3>

            <div class="enrollment-stats">
              <div class="stat-item">
                <span class="stat-number">{{ course.enrolledCount }}</span>
                <span class="stat-label">Inscriptos</span>
              </div>

              <div class="stat-divider"></div>

              <div class="stat-item">
                <span class="stat-number">{{ course.capacity }}</span>
                <span class="stat-label">L√≠mite de cupos</span>
              </div>
            </div>

            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="(course.enrolledCount / course.capacity) * 100"
                [ngClass]="{
                  'progress-full': isFull(),
                  'progress-high': course.enrolledCount / course.capacity > 0.8 && !isFull(),
                  'progress-medium': course.enrolledCount / course.capacity > 0.5 && course.enrolledCount / course.capacity <= 0.8
                }"
              ></div>
            </div>

            <app-enrollment-form
              [courseId]="course.id"
              [isFull]="isFull()"
              (enrollmentSuccess)="onEnrollmentSuccess()">
            </app-enrollment-form>
          </div>
        </div>
      </div>
      </div>
    }
  </div>
</div>
